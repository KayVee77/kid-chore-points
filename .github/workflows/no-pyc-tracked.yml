name: "No Tracked .pyc Files"

on:
  push:
    branches: [ '**' ]
  pull_request:
    branches: [ '**' ]

jobs:
  no-pyc:
    name: Ensure no tracked .pyc or __pycache__ files
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Check for tracked .pyc and __pycache__ files
        run: |
          set -e
          echo "Checking repository for tracked .pyc files and __pycache__ paths..."
          tracked_pyc=$(git ls-files '*.pyc' || true)
          tracked_cache=$(git ls-files '*__pycache__/*' || true)

          if [ -n "$tracked_pyc" ] || [ -n "$tracked_cache" ]; then
            echo "ERROR: Found tracked Python bytecode files or __pycache__ entries:"
            git ls-files '*.pyc' || true
            git ls-files '*__pycache__/*' || true
            echo "\nMake sure .gitignore contains patterns for __pycache__/ and *.pyc, then remove them from the index with: git rm --cached <path>"
            exit 1
          fi

          echo "No tracked .pyc or __pycache__ files found."
