{% extends "base.html" %}
{% block content %}
  <style>
    .kid-grid {display:grid; grid-template-columns:repeat(auto-fill,minmax(120px,1fr)); gap:1rem; margin:1rem 0;}
    .kid-tile {border:3px solid #222; border-radius:1rem; padding:.75rem .5rem; text-align:center; cursor:pointer; transition:.25s; background:linear-gradient(135deg,#fff,#f1f1f1); position:relative; overflow:hidden;}
    .kid-tile:before {content:""; position:absolute; inset:0; background:radial-gradient(circle at 30% 20%,rgba(255,255,255,.6),transparent); opacity:.7; pointer-events:none;}
    .kid-tile.selected {border-color:#ff9800; box-shadow:0 4px 12px -2px rgba(0,0,0,.35); transform:translateY(-4px);}
    .kid-tile .avatar {font-size:2.4rem; display:block; line-height:1;}
    .kid-tile input {display:none;}
    .kid-photo {width:64px; height:64px; object-fit:cover; border-radius:50%; box-shadow:0 2px 4px rgba(0,0,0,.25); margin:0 auto .25rem auto; display:block;}
  </style>
  <h2>Pasirink savo profilį</h2>
  <form method="post" id="kid-login-form">
    {% csrf_token %}
    <div style="margin-bottom:.5rem;">Įvesk PIN:</div>
    {{ form.pin }}
    <div style="margin-top:1rem;">Vaikai:</div>
    <div class="kid-grid">
      {% for option in form.kid.field.queryset %}
        <label class="kid-tile" data-kid-id="{{ option.id }}">
          <input type="radio" name="kid" value="{{ option.id }}" {% if form.kid.value == option.id %}checked{% endif %}>
          {% if option.photo %}
            <img src="{{ option.photo.url }}" class="kid-photo" alt="{{ option.name }}">
          {% elif option.avatar_emoji %}
            <span class="avatar">{{ option.avatar_emoji }}</span>
          {% else %}
            <span class="avatar" style="background:#1976d2; color:#fff; width:64px; height:64px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:1.8rem; margin:0 auto .25rem; box-shadow:0 2px 4px rgba(0,0,0,.25);">{{ option.display_letter }}</span>
          {% endif %}
          <span style="font-weight:600; display:block;">{{ option.name }}</span>
        </label>
      {% empty %}
        <p>Nėra vaikų.</p>
      {% endfor %}
    </div>
    <button class="btn" type="submit">Prisijungti</button>
  </form>
  <script>
    (function(){
      const tiles=[...document.querySelectorAll('.kid-tile')];
      function sync(){tiles.forEach(t=>{const i=t.querySelector('input'); t.classList.toggle('selected', i.checked);});}
      tiles.forEach(t=>t.addEventListener('click',()=>{const i=t.querySelector('input'); i.checked=true; sync();}));
      sync();
    })();
  </script>
{% endblock %}
